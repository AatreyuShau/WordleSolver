<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Wordle Solver</title>

<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
  }

  .cell {
    width: 40px;
    height: 40px;
    border: 1px solid #555;
    text-align: center;
    font-size: 20px;
    font-weight: bold;
    text-transform: uppercase;
    cursor: pointer;
  }

  .gray { background: #787c7e; color: white; }
  .yellow { background: #c9b458; color: white; }
  .green { background: #6aaa64; color: white; }

  table { border-collapse: collapse; }
  td { padding: 2px; }

  #results {
    margin-top: 20px;
    white-space: pre-wrap;
    max-height: 300px;
    overflow-y: auto;
    border: 1px solid #ccc;
    padding: 10px;
  }
</style>
</head>

<body>

<h2>Wordle Solver</h2>

<label>Word length:
  <input id="w" type="number" value="5" min="1">
</label>

<label>Attempts:
  <input id="h" type="number" value="6" min="1">
</label>

<button onclick="makeGrid()">Create Grid</button>
<button onclick="analyze()">Analyze</button>

<br><br>

<div id="grid"></div>

<h3>Results</h3>
<div id="results">(results will appear here)</div>

<script>
let grid = [];
let colors = [];

function makeGrid() {
  const w = +document.getElementById("w").value;
  const h = +document.getElementById("h").value;

  grid = Array.from({length: h}, () => Array(w).fill(""));
  colors = Array.from({length: h}, () => Array(w).fill("gray"));

  let html = "<table>";
  for (let r = 0; r < h; r++) {
    html += "<tr>";
    for (let c = 0; c < w; c++) {
      html += `
        <td>
          <input class="cell gray"
            maxlength="1"
            data-r="${r}"
            data-c="${c}"
            oninput="typeCell(this)"
            onclick="cycleColor(this)">
        </td>`;
    }
    html += "</tr>";
  }
  html += "</table>";

  document.getElementById("grid").innerHTML = html;
}

function typeCell(el) {
  const r = el.dataset.r;
  const c = el.dataset.c;
  el.value = el.value.toUpperCase();
  grid[r][c] = el.value.toLowerCase();
}

function cycleColor(el) {
  const r = el.dataset.r;
  const c = el.dataset.c;
  const order = ["gray", "yellow", "green"];
  let idx = order.indexOf(colors[r][c]);
  colors[r][c] = order[(idx + 1) % 3];
  el.className = "cell " + colors[r][c];
}

function analyze() {
  const h = grid.length;
  const w = grid[0].length;

  let greens = {};
  let yellows = {};
  let grays = new Set();
  let min_freq = {};

  for (let r = 0; r < h; r++) {
    for (let c = 0; c < w; c++) {
      const ch = grid[r][c];
      if (!ch) continue;

      const color = colors[r][c];

      if (color === "green") {
        greens[c] = ch;
        min_freq[ch] = (min_freq[ch] || 0) + 1;
      } 
      else if (color === "yellow") {
        if (!yellows[ch]) yellows[ch] = [];
        yellows[ch].push(c);
        min_freq[ch] = (min_freq[ch] || 0) + 1;
      } 
      else {
        grays.add(ch);
      }
    }
  }

  const payload = {
    greens: greens,
    yellows: yellows,
    grays: Array.from(grays),
    min_freq: min_freq,
    length: w
  };

  fetch("http://127.0.0.1:8000/solve", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify(payload)
  })
  .then(res => res.json())
  .then(data => {
    document.getElementById("results").textContent =
      `Found ${data.count} words:\n\n` + data.words.join(", ");
  })
  .catch(err => {
    document.getElementById("results").textContent =
      "Backend not reachable.\nMake sure FastAPI is running.";
  });
}
</script>

</body>
</html>
